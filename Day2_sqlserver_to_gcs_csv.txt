How Connection Details Are Defined (VERY IMPORTANT)
In Cloud Composer:
All credentials live in Airflow Connections
DAG only references conn_id
Admin â†’ Connections â†’ + Add
Step 2: Fill Details
Field	Value
Conn Id	mssql_prod
Conn Type	Microsoft SQL Server
Host	sqlserver.bank.internal
Schema	coredb
Login	etl_user
Password	ğŸ”’ (secret)
Port	1433

This is a very sharp question â€” youâ€™re basically asking:
â€œIf the DAG is scheduled only once per day at 2 AM, why do we even need max_active_runs = 1?â€
Letâ€™s answer this slowly, logically, and with real production truth, not theory.
ğŸ”‘ Short truth (but deep meaning)
Scheduling controls when a DAG is triggered.
max_active_runs controls how many times it is allowed to run concurrently.
Even a â€œonce-a-dayâ€ DAG can accidentally run more than once at the same time.
ğŸ§  Why scheduling alone is NOT enough
You are assuming:
One trigger at 2 AM
Previous run always finishes before next trigger
No manual triggers
No retries extending runtime
No backfill
No failures
âŒ Production never behaves this cleanly
ğŸ”¥ Real Productio Scenarios (This is why max_active_runs exists)
1ï¸âƒ£ DAG runs longer than expected
Day 1 â€“ 2:00 AM â†’ DAG starts
Day 1 â€“ 4:30 AM â†’ DAG still running
Day 2 â€“ 2:00 AM â†’ Scheduler triggers next run
Without max_active_runs=1:
Day 1 run still running
Day 2 run starts
Same pipeline running twice âŒ
With max_active_runs=1:
Day 2 run is queued
Starts only after Day 1 finishes âœ…
2ï¸âƒ£ Manual trigger by engineer
2:00 AM â†’ Scheduled run starts
2:15 AM â†’ Engineer clicks "Trigger DAG"
Without max_active_runs=1:
Two runs overlap âŒ
With it:
Manual run waits âœ…
3ï¸âƒ£ Backfill / Catchup enabled
DAG paused for 5 days
Unpaused â†’ 5 DAG runs scheduled instantly
Without max_active_runs=1:
All 5 runs execute in parallel âŒ
With it:
Runs execute one-by-one âœ…
4ï¸âƒ£ Retry + Long Retry Delay
2:00 AM â†’ Run starts
2:10 AM â†’ Task fails
Retry delay = 30 mins
2:40 AM â†’ Retry happens
Meanwhile:
2:00 AM next day â†’ New scheduled ru
Overlap happens without control âŒ
ğŸ“Œ Key Insight (Very Important)
Schedule interval â‰  execution guarantee
Airflow scheduler:
Only creates DAG runs
Does NOT ensure old run finished
Thatâ€™s YOUR responsibility.
ğŸ§ª Visual Timeline
âŒ Without max_active_runs
Day 1 Run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”œâ”€â”€ Overlap âŒ
Day 2 Run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… With max_active_runs=1
Day 1 Run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â””â”€â”€ Day 2 waits
Day 2 Run      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

